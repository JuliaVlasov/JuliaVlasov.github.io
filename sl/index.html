<!doctype html> <html lang=en > <meta charset=UTF-8 > <meta name=viewport  content="width=device-width, initial-scale=1"> <link rel=stylesheet  href="/libs/katex/katex.min.css"> <link rel=stylesheet  href="/libs/highlight/github.min.css"> <link rel=stylesheet  href="/css/franklin.css"> <link rel=stylesheet  href="/css/poole_hyde.css"> <style> html {font-size: 17px;} .franklin-content {position: relative; padding-left: 8%; padding-right: 5%; line-height: 1.35em;} @media (min-width: 940px) { .franklin-content {width: 100%; margin-left: auto; margin-right: auto;} } @media (max-width: 768px) { .franklin-content {padding-left: 6%; padding-right: 6%;} } </style> <link rel=icon  href="/assets/favicon.png"> <title>Semi Lagrangian</title> <div class=sidebar > <div class="container sidebar"> <div class=sidebar-about > <h1><a href="/">Julia Vlasov</a></h1> <p class=lead >Organisation for Vlasov codes in Julia</p> </div> <nav class=sidebar-nav > <a class="sidebar-nav-item " href="/">Home</a> <a class="sidebar-nav-item " href="/gempic/">GEMPIC</a> <a class="sidebar-nav-item active" href="/sl/">SemiLagrangian</a> <a class="sidebar-nav-item " href="/fourier/">FourierAdvections</a> <a class="sidebar-nav-item " href="/pages/numkin2019/">Numkin 2019</a> </nav> <p>&copy; Pierre Navaro. </p> <p><a href="https://github.com/juliavlasov"> <p><i class="fa fa-github"></i>Edit on GitHub</a>.</p> </div> </div> <div class="content container"> <div class=franklin-content ><p><strong>This is a draft with some ideas for a SemiLagrangian package.</strong></p> <h2 id=semi-lagrangian_method ><a href="#semi-lagrangian_method">Semi-Lagrangian method</a></h2> <p>Let us consider an abstract scalar advection equation of the form</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mrow><mi mathvariant=normal >∂</mi><mi>f</mi></mrow><mrow><mi mathvariant=normal >∂</mi><mi>t</mi></mrow></mfrac><mo>+</mo><mi>a</mi><mo stretchy=false >(</mo><mi>x</mi><mo separator=true >,</mo><mi>t</mi><mo stretchy=false >)</mo><mo>⋅</mo><mi mathvariant=normal >∇</mi><mi>f</mi><mo>=</mo><mn>0.</mn></mrow><annotation encoding="application/x-tex"> \frac{\partial f}{\partial t}+ a(x, t) \cdot \nabla f = 0. </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:2.0574399999999997em;vertical-align:-0.686em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.3714399999999998em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathdefault">t</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">a</span><span class=mopen >(</span><span class="mord mathdefault">x</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">t</span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >⋅</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class=mord >∇</span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.64444em;vertical-align:0em;"></span><span class=mord >0</span><span class=mord >.</span></span></span></span></span> <p>The characteristic curves associated to this equation are the solutions of the ordinary differential equations</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mrow><mi>d</mi><mi>X</mi></mrow><mrow><mi>d</mi><mi>t</mi></mrow></mfrac><mo>=</mo><mi>a</mi><mo stretchy=false >(</mo><mi>X</mi><mo stretchy=false >(</mo><mi>t</mi><mo stretchy=false >)</mo><mo separator=true >,</mo><mi>t</mi><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex"> \frac{dX}{dt} = a(X(t), t) </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:2.05744em;vertical-align:-0.686em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.37144em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathdefault">d</span><span class="mord mathdefault">t</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathdefault">d</span><span class="mord mathdefault" style="margin-right:0.07847em;">X</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">a</span><span class=mopen >(</span><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class=mopen >(</span><span class="mord mathdefault">t</span><span class=mclose >)</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">t</span><span class=mclose >)</span></span></span></span></span> <p>We shall denote by <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi><mo stretchy=false >(</mo><mi>t</mi><mo separator=true >,</mo><mi>x</mi><mo separator=true >,</mo><mi>s</mi><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">X(t, x, s)</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class=mopen >(</span><span class="mord mathdefault">t</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">x</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">s</span><span class=mclose >)</span></span></span></span> the unique solution of this equation associated to the initial condition <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi><mo stretchy=false >(</mo><mi>s</mi><mo stretchy=false >)</mo><mo>=</mo><mi>x</mi></mrow><annotation encoding="application/x-tex">X(s) = x</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class=mopen >(</span><span class="mord mathdefault">s</span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">x</span></span></span></span>.</p> <p>The classical semi-Lagrangian method is based on a backtracking of characteristics. Two steps are needed to update the distribution function <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>f</mi><mrow><mi>n</mi><mo>+</mo><mn>1</mn></mrow></msup></mrow><annotation encoding="application/x-tex">f^{n+1}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1.008548em;vertical-align:-0.19444em;"></span><span class=mord ><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span></span></span> at <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>t</mi><mrow><mi>n</mi><mo>+</mo><mn>1</mn></mrow></msup></mrow><annotation encoding="application/x-tex">t^{n+1}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8141079999999999em;vertical-align:0em;"></span><span class=mord ><span class="mord mathdefault">t</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span></span></span> from its value <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>f</mi><mi>n</mi></msup></mrow><annotation encoding="application/x-tex">f^n</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class=mord ><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span></span></span></span></span></span></span></span> at time <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>t</mi><mi>n</mi></msup></mrow><annotation encoding="application/x-tex">t^n</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.664392em;vertical-align:0em;"></span><span class=mord ><span class="mord mathdefault">t</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span></span></span></span></span></span></span></span> :</p> <ol> <li><p>For each grid point <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">x_i</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.58056em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathdefault">x</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> compute <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi><mo stretchy=false >(</mo><msup><mi>t</mi><mi>n</mi></msup><mo separator=true >;</mo><msub><mi>x</mi><mi>i</mi></msub><mo separator=true >,</mo><msup><mi>t</mi><mrow><mi>n</mi><mo>+</mo><mn>1</mn></mrow></msup><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">X(t^n; x_i, t^{n+1})</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1.064108em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class=mopen >(</span><span class=mord ><span class="mord mathdefault">t</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span></span></span></span></span><span class=mpunct >;</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord ><span class="mord mathdefault">x</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord ><span class="mord mathdefault">t</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class=mclose >)</span></span></span></span> the value of the characteristic at <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>t</mi><mi>n</mi></msup></mrow><annotation encoding="application/x-tex">t^n</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.664392em;vertical-align:0em;"></span><span class=mord ><span class="mord mathdefault">t</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span></span></span></span></span></span></span></span> which takes the value <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">x_i</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.58056em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathdefault">x</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> at <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>t</mi><mrow><mi>n</mi><mo>+</mo><mn>1</mn></mrow></msup></mrow><annotation encoding="application/x-tex">t^{n+1}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8141079999999999em;vertical-align:0em;"></span><span class=mord ><span class="mord mathdefault">t</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span></span></span>.</p> <li><p>As the distribution solution of first equation verifies </p> </ol> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>f</mi><mrow><mi>n</mi><mo>+</mo><mn>1</mn></mrow></msup><mo stretchy=false >(</mo><msub><mi>x</mi><mi>i</mi></msub><mo stretchy=false >)</mo><mo>=</mo><msup><mi>f</mi><mi>n</mi></msup><mo stretchy=false >(</mo><mi>X</mi><mo stretchy=false >(</mo><msup><mi>t</mi><mi>n</mi></msup><mo separator=true >;</mo><msub><mi>x</mi><mi>i</mi></msub><mo separator=true >,</mo><msup><mi>t</mi><mrow><mi>n</mi><mo>+</mo><mn>1</mn></mrow></msup><mo stretchy=false >)</mo><mo stretchy=false >)</mo><mo separator=true >,</mo></mrow><annotation encoding="application/x-tex">f^{n+1}(x_i) = f^n(X(t^n; x_i, t^{n+1})),</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1.1141079999999999em;vertical-align:-0.25em;"></span><span class=mord ><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.864108em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class=mopen >(</span><span class=mord ><span class="mord mathdefault">x</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1.1141079999999999em;vertical-align:-0.25em;"></span><span class=mord ><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.7143919999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span></span></span></span></span><span class=mopen >(</span><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class=mopen >(</span><span class=mord ><span class="mord mathdefault">t</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.7143919999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span></span></span></span></span><span class=mpunct >;</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord ><span class="mord mathdefault">x</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord ><span class="mord mathdefault">t</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.864108em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class=mclose >)</span><span class=mclose >)</span><span class=mpunct >,</span></span></span></span></span> <p>we obtain the desired value of <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>f</mi><mrow><mi>n</mi><mo>+</mo><mn>1</mn></mrow></msup><mo stretchy=false >(</mo><msub><mi>x</mi><mi>i</mi></msub><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">f^{n+1}(x_i)</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1.064108em;vertical-align:-0.25em;"></span><span class=mord ><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class=mopen >(</span><span class=mord ><span class="mord mathdefault">x</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mclose >)</span></span></span></span> by computing <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>f</mi><mi>n</mi></msup><mo stretchy=false >(</mo><mi>X</mi><mo stretchy=false >(</mo><msup><mi>t</mi><mi>n</mi></msup><mo separator=true >;</mo><msub><mi>x</mi><mi>i</mi></msub><mo separator=true >,</mo><msup><mi>t</mi><mrow><mi>n</mi><mo>+</mo><mn>1</mn></mrow></msup><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">f^n(X(t^n;x_i,t^{n+1})</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1.064108em;vertical-align:-0.25em;"></span><span class=mord ><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span></span></span></span></span><span class=mopen >(</span><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class=mopen >(</span><span class=mord ><span class="mord mathdefault">t</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span></span></span></span></span><span class=mpunct >;</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord ><span class="mord mathdefault">x</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord ><span class="mord mathdefault">t</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class=mclose >)</span></span></span></span> by interpolation as <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi><mo stretchy=false >(</mo><msup><mi>t</mi><mi>n</mi></msup><mo separator=true >;</mo><msub><mi>x</mi><mi>i</mi></msub><mo separator=true >,</mo><msup><mi>t</mi><mrow><mi>n</mi><mo>+</mo><mn>1</mn></mrow></msup><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">X(t^n; x_i, t^{n+1})</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1.064108em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class=mopen >(</span><span class=mord ><span class="mord mathdefault">t</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span></span></span></span></span><span class=mpunct >;</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord ><span class="mord mathdefault">x</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord ><span class="mord mathdefault">t</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class=mclose >)</span></span></span></span> is in general not a grid point.</p> <p><em><a href="http://www-m16.ma.tum.de/foswiki/pub/M16/Allgemeines/NumMethVlasov/Num-Meth-Vlasov-Notes.pdf">Eric Sonnendrücker - Numerical methods for the Vlasov equations</a></em></p> <pre><code class="julia hljs"><span class=hljs-keyword >using</span> Plots, FFTW, LinearAlgebra, Statistics, BenchmarkTools</code></pre>
<h2 id=bspline ><a href="#bspline">Bspline</a></h2>
<p>bspline&#40;p, j, x&#41;</p>
<p>Return the value at x in &#91;0,1&#91; of the B-spline with integer  nodes of degree p with support starting at j. Implemented recursively using the  <a href="https://en.wikipedia.org/wiki/De_Boor&#37;27s_algorithm">De Boor&#39;s Algorithm</a></p>
<span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>B</mi><mrow><mi>i</mi><mo separator=true >,</mo><mn>0</mn></mrow></msub><mo stretchy=false >(</mo><mi>x</mi><mo stretchy=false >)</mo><mo>:</mo><mo>=</mo><mrow><mo fence=true >{</mo><mtable rowspacing=0.15999999999999992em  columnspacing=1em ><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><mrow><mrow><mi mathvariant=normal >i</mi><mi mathvariant=normal >f</mi></mrow><mspace width=1em /><msub><mi>t</mi><mi>i</mi></msub><mo>≤</mo><mi>x</mi><mo>&lt;</mo><msub><mi>t</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><mrow><mi mathvariant=normal >o</mi><mi mathvariant=normal >t</mi><mi mathvariant=normal >h</mi><mi mathvariant=normal >e</mi><mi mathvariant=normal >r</mi><mi mathvariant=normal >w</mi><mi mathvariant=normal >i</mi><mi mathvariant=normal >s</mi><mi mathvariant=normal >e</mi></mrow></mstyle></mtd></mtr></mtable></mrow></mrow><annotation encoding="application/x-tex">
B_{i,0}(x) := \left\{ \begin{matrix}
1 &amp; \mathrm{if}  \quad t_i ≤ x &lt; t_{i+1} \\
0 &amp; \mathrm{otherwise} 
\end{matrix}
\right.
</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1.036108em;vertical-align:-0.286108em;"></span><span class=mord ><span class="mord mathdefault" style="margin-right:0.05017em;">B</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.05017em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mpunct mtight">,</span><span class="mord mtight">0</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.286108em;"><span></span></span></span></span></span></span><span class=mopen >(</span><span class="mord mathdefault">x</span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >:</span></span><span class=base ><span class=strut  style="height:0.36687em;vertical-align:0em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:2.40003em;vertical-align:-0.95003em;"></span><span class=minner ><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">{</span></span><span class=mord ><span class=mtable ><span class=col-align-c ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.45em;"><span style="top:-3.61em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >1</span></span></span><span style="top:-2.4099999999999997em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >0</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.9500000000000004em;"><span></span></span></span></span></span><span class=arraycolsep  style="width:0.5em;"></span><span class=arraycolsep  style="width:0.5em;"></span><span class=col-align-c ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.45em;"><span style="top:-3.61em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathrm">i</span><span class="mord mathrm" style="margin-right:0.07778em;">f</span></span><span class=mspace  style="margin-right:1em;"></span><span class=mord ><span class="mord mathdefault">t</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >≤</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class="mord mathdefault">x</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >&lt;</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mord ><span class="mord mathdefault">t</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.208331em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.4099999999999997em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathrm">o</span><span class="mord mathrm">t</span><span class="mord mathrm">h</span><span class="mord mathrm">e</span><span class="mord mathrm">r</span><span class="mord mathrm" style="margin-right:0.01389em;">w</span><span class="mord mathrm">i</span><span class="mord mathrm">s</span><span class="mord mathrm">e</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.9500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span>
<span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>B</mi><mrow><mi>i</mi><mo separator=true >,</mo><mi>p</mi></mrow></msub><mo stretchy=false >(</mo><mi>x</mi><mo stretchy=false >)</mo><mo>:</mo><mo>=</mo><mfrac><mrow><mi>x</mi><mo>−</mo><msub><mi>t</mi><mi>i</mi></msub></mrow><mrow><msub><mi>t</mi><mrow><mi>i</mi><mo>+</mo><mi>p</mi></mrow></msub><mo>−</mo><msub><mi>t</mi><mi>i</mi></msub></mrow></mfrac><msub><mi>B</mi><mrow><mi>i</mi><mo separator=true >,</mo><mi>p</mi><mo>−</mo><mn>1</mn></mrow></msub><mo stretchy=false >(</mo><mi>x</mi><mo stretchy=false >)</mo><mo>+</mo><mfrac><mrow><msub><mi>t</mi><mrow><mi>i</mi><mo>+</mo><mi>p</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>−</mo><mi>x</mi></mrow><mrow><msub><mi>t</mi><mrow><mi>i</mi><mo>+</mo><mi>p</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>−</mo><msub><mi>t</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub></mrow></mfrac><msub><mi>B</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn><mo separator=true >,</mo><mi>p</mi><mo>−</mo><mn>1</mn></mrow></msub><mo stretchy=false >(</mo><mi>x</mi><mo stretchy=false >)</mo><mi mathvariant=normal >.</mi></mrow><annotation encoding="application/x-tex">
B_{i,p}(x) := \frac{x - t_i}{t_{i+p} - t_i} B_{i,p-1}(x) 
+ \frac{t_{i+p+1} - x}{t_{i+p+1} - t_{i+1}} B_{i+1,p-1}(x).
</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1.036108em;vertical-align:-0.286108em;"></span><span class=mord ><span class="mord mathdefault" style="margin-right:0.05017em;">B</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.05017em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathdefault mtight">p</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.286108em;"><span></span></span></span></span></span></span><span class=mopen >(</span><span class="mord mathdefault">x</span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >:</span></span><span class=base ><span class=strut  style="height:0.36687em;vertical-align:0em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:2.264188em;vertical-align:-0.972108em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.29208em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathdefault">t</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">+</span><span class="mord mathdefault mtight">p</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.286108em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord ><span class="mord mathdefault">t</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathdefault">x</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord ><span class="mord mathdefault">t</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.972108em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mord ><span class="mord mathdefault" style="margin-right:0.05017em;">B</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.05017em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathdefault mtight">p</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.286108em;"><span></span></span></span></span></span></span><span class=mopen >(</span><span class="mord mathdefault">x</span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:2.264188em;vertical-align:-0.972108em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.29208em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathdefault">t</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">+</span><span class="mord mathdefault mtight">p</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.286108em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord ><span class="mord mathdefault">t</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.208331em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathdefault">t</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">+</span><span class="mord mathdefault mtight">p</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.286108em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault">x</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.972108em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mord ><span class="mord mathdefault" style="margin-right:0.05017em;">B</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.05017em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">+</span><span class="mord mtight">1</span><span class="mpunct mtight">,</span><span class="mord mathdefault mtight">p</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.286108em;"><span></span></span></span></span></span></span><span class=mopen >(</span><span class="mord mathdefault">x</span><span class=mclose >)</span><span class=mord >.</span></span></span></span></span>
<pre><code class="julia hljs"><span class=hljs-keyword >function</span> bspline(p::<span class=hljs-built_in >Int</span>, j::<span class=hljs-built_in >Int</span>, x::<span class=hljs-built_in >Float64</span>)
   <span class=hljs-keyword >if</span> p == <span class=hljs-number >0</span>
       <span class=hljs-keyword >if</span> j == <span class=hljs-number >0</span>
           <span class=hljs-keyword >return</span> <span class=hljs-number >1.0</span>
       <span class=hljs-keyword >else</span>
           <span class=hljs-keyword >return</span> <span class=hljs-number >0.0</span>
       <span class=hljs-keyword >end</span>
   <span class=hljs-keyword >else</span>
       w = (x - j) / p
       w1 = (x - j - <span class=hljs-number >1</span>) / p
   <span class=hljs-keyword >end</span>
   <span class=hljs-keyword >return</span> (w * bspline(p - <span class=hljs-number >1</span>, j, x) + (<span class=hljs-number >1</span> - w1) * bspline(p - <span class=hljs-number >1</span>, j + <span class=hljs-number >1</span>, x))
<span class=hljs-keyword >end</span></code></pre>
<pre><code class="julia hljs"><span class=hljs-string >&quot;&quot;&quot;
    UniformMesh(xmin, xmax, nx)

1D uniform mesh data
&quot;&quot;&quot;</span>
<span class=hljs-keyword >struct</span> UniformMesh
   xmin  :: <span class=hljs-built_in >Float64</span>
   xmax  :: <span class=hljs-built_in >Float64</span>
   nx    :: <span class=hljs-built_in >Int</span>
   dx    :: <span class=hljs-built_in >Float64</span>
   x     :: <span class=hljs-built_in >Vector</span>{<span class=hljs-built_in >Float64</span>}
   <span class=hljs-keyword >function</span> UniformMesh(xmin, xmax, nx)
      dx = (xmax - xmin) / nx
      x  = range(xmin, stop=xmax, length=nx+<span class=hljs-number >1</span>)[<span class=hljs-number >1</span>:<span class=hljs-keyword >end</span>-<span class=hljs-number >1</span>]     
      new( xmin, xmax, nx, dx, x)
   <span class=hljs-keyword >end</span>
<span class=hljs-keyword >end</span></code></pre>
<pre><code class="julia hljs"><span class=hljs-string >&quot;&quot;&quot;
    advection!(f, p, mesh, v, dt)

function to advect the distribution function `f` with velocity `v`
during a time step `dt`. Interpolation method uses bspline periodic.
&quot;&quot;&quot;</span>
<span class=hljs-keyword >function</span> advection!(f    :: <span class=hljs-built_in >Array</span>{<span class=hljs-built_in >Complex</span>{<span class=hljs-built_in >Float64</span>},<span class=hljs-number >2</span>}, 
                    p    :: <span class=hljs-built_in >Int64</span>, 
                    mesh :: UniformMesh, 
                    v    :: <span class=hljs-built_in >Vector</span>{<span class=hljs-built_in >Float64</span>}, 
                    dt   :: <span class=hljs-built_in >Float64</span>)
    
   nx = mesh.nx
   nv = length(v)
   dx = mesh.dx
   modes = [<span class=hljs-number >2</span><span class=hljs-literal >π</span> * i / nx <span class=hljs-keyword >for</span> i <span class=hljs-keyword >in</span> <span class=hljs-number >0</span>:nx-<span class=hljs-number >1</span>]
    
   <span class=hljs-comment ># compute eigenvalues of degree p b-spline matrix</span>
   eig_bspl  = zeros(<span class=hljs-built_in >Float64</span>, nx)
   eig_bspl .= bspline(p, -div(p+<span class=hljs-number >1</span>,<span class=hljs-number >2</span>), <span class=hljs-number >0.0</span>)
   <span class=hljs-keyword >for</span> i <span class=hljs-keyword >in</span> <span class=hljs-number >1</span>:div(p+<span class=hljs-number >1</span>,<span class=hljs-number >2</span>)-<span class=hljs-number >1</span>
      eig_bspl .+= bspline(p, i - (p+<span class=hljs-number >1</span>)÷<span class=hljs-number >2</span>, <span class=hljs-number >0.0</span>) * <span class=hljs-number >2</span> .* cos.(i * modes)
   <span class=hljs-keyword >end</span>
   eigalpha = zeros(<span class=hljs-built_in >Complex</span>{<span class=hljs-built_in >Float64</span>}, nx)
    
   fft!(f,<span class=hljs-number >1</span>)
    
   <span class=hljs-keyword >for</span> j <span class=hljs-keyword >in</span> <span class=hljs-number >1</span>:nv
      <span class=hljs-meta >@inbounds</span> alpha = dt * v[j] / dx
      <span class=hljs-comment ># compute eigenvalues of cubic splines evaluated at displaced points</span>
      ishift = floor(-alpha)
      beta   = -ishift - alpha
      fill!(eigalpha,<span class=hljs-number >0.0</span><span class=hljs-literal >im</span>)
      <span class=hljs-keyword >for</span> i <span class=hljs-keyword >in</span> -div(p-<span class=hljs-number >1</span>,<span class=hljs-number >2</span>):div(p+<span class=hljs-number >1</span>,<span class=hljs-number >2</span>)
         eigalpha .+= (bspline(p, i-div(p+<span class=hljs-number >1</span>,<span class=hljs-number >2</span>), beta) 
                        .* exp.((ishift+i) * <span class=hljs-number >1</span><span class=hljs-literal >im</span> .* modes))
      <span class=hljs-keyword >end</span>
          
      <span class=hljs-comment ># compute interpolating spline using fft and properties of circulant matrices</span>
      
      <span class=hljs-meta >@inbounds</span> f[:,j] .*= eigalpha ./ eig_bspl
        
   <span class=hljs-keyword >end</span>
        
   ifft!(f,<span class=hljs-number >1</span>)
    
<span class=hljs-keyword >end</span></code></pre>
<h1 id=vlasov-poisson_equation ><a href="#vlasov-poisson_equation">Vlasov-Poisson equation</a></h1>
<p>We consider the dimensionless Vlasov-Poisson equation for one species with a neutralizing background.</p>
<span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mrow><mi mathvariant=normal >∂</mi><mi>f</mi></mrow><mrow><mi mathvariant=normal >∂</mi><mi>t</mi></mrow></mfrac><mo>+</mo><mi>v</mi><mo>⋅</mo><msub><mi mathvariant=normal >∇</mi><mi>x</mi></msub><mi>f</mi><mo>+</mo><mi>E</mi><mo stretchy=false >(</mo><mi>t</mi><mo separator=true >,</mo><mi>x</mi><mo stretchy=false >)</mo><mo>⋅</mo><msub><mi mathvariant=normal >∇</mi><mi>v</mi></msub><mi>f</mi><mo>=</mo><mn>0</mn><mo separator=true >,</mo></mrow><annotation encoding="application/x-tex"> 
\frac{\partial f}{\partial t}+ v\cdot \nabla_x f + E(t,x) \cdot \nabla_v f = 0, 
</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:2.0574399999999997em;vertical-align:-0.686em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.3714399999999998em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathdefault">t</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:0.44445em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >⋅</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class=mord ><span class=mord >∇</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">x</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class=mopen >(</span><span class="mord mathdefault">t</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">x</span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >⋅</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class=mord ><span class=mord >∇</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">v</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.8388800000000001em;vertical-align:-0.19444em;"></span><span class=mord >0</span><span class=mpunct >,</span></span></span></span></span>
<span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>−</mo><mi mathvariant=normal >Δ</mi><mi>ϕ</mi><mo>=</mo><mn>1</mn><mo>−</mo><mi>ρ</mi><mo separator=true >,</mo><mi>E</mi><mo>=</mo><mo>−</mo><mi mathvariant=normal >∇</mi><mi>ϕ</mi></mrow><annotation encoding="application/x-tex">
- \Delta \phi = 1 - \rho, E = - \nabla \phi 
</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class=mord >−</span><span class=mord >Δ</span><span class="mord mathdefault">ϕ</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.72777em;vertical-align:-0.08333em;"></span><span class=mord >1</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">ρ</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class=mord >−</span><span class=mord >∇</span><span class="mord mathdefault">ϕ</span></span></span></span></span>
<span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ρ</mi><mo stretchy=false >(</mo><mi>t</mi><mo separator=true >,</mo><mi>x</mi><mo stretchy=false >)</mo><mo>=</mo><mo>∫</mo><mi>f</mi><mo stretchy=false >(</mo><mi>t</mi><mo separator=true >,</mo><mi>x</mi><mo separator=true >,</mo><mi>v</mi><mo stretchy=false >)</mo><mi>d</mi><mi>v</mi><mi mathvariant=normal >.</mi></mrow><annotation encoding="application/x-tex">
\rho(t,x)  =  \int f(t,x,v)dv.
</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">ρ</span><span class=mopen >(</span><span class="mord mathdefault">t</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">x</span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:2.22225em;vertical-align:-0.86225em;"></span><span class="mop op-symbol large-op" style="margin-right:0.44445em;position:relative;top:-0.0011249999999999316em;">∫</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class=mopen >(</span><span class="mord mathdefault">t</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">x</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class=mclose >)</span><span class="mord mathdefault">d</span><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class=mord >.</span></span></span></span></span>
<ul>
<li><p><a href="https://en.wikipedia.org/wiki/Vlasov_equation">Vlasov Equation - Wikipedia</a></p>

</ul>
<pre><code class="julia hljs"><span class=hljs-string >&quot;&quot;&quot;
    compute_rho(meshv, f)

Compute charge density
ρ(x,t) = ∫ f(x,v,t) dv
&quot;&quot;&quot;</span>
<span class=hljs-keyword >function</span> compute_rho(meshv::UniformMesh, 
        f::<span class=hljs-built_in >Array</span>{<span class=hljs-built_in >Complex</span>{<span class=hljs-built_in >Float64</span>},<span class=hljs-number >2</span>})
    
   dv = meshv.dx
   rho = dv * sum(real(f), dims=<span class=hljs-number >2</span>)
   vec(rho .- mean(rho)) <span class=hljs-comment ># vec squeezes the 2d array returned by sum function</span>
<span class=hljs-keyword >end</span>

<span class=hljs-string >&quot;&quot;&quot;
    compute_e(meshx, rho)
compute Ex using that -ik*Ex = rho 
&quot;&quot;&quot;</span>
<span class=hljs-keyword >function</span> compute_e(meshx::UniformMesh, rho::<span class=hljs-built_in >Vector</span>{<span class=hljs-built_in >Float64</span>})
   nx = meshx.nx
   k =  <span class=hljs-number >2</span><span class=hljs-literal >π</span> / (meshx.xmax - meshx.xmin)
   modes = zeros(<span class=hljs-built_in >Float64</span>, nx)
   modes .= k * vcat(<span class=hljs-number >0</span>:div(nx,<span class=hljs-number >2</span>)-<span class=hljs-number >1</span>,-div(nx,<span class=hljs-number >2</span>):-<span class=hljs-number >1</span>)
   modes[<span class=hljs-number >1</span>] = <span class=hljs-number >1.0</span>
   rhok = fft(rho)./modes
   rhok .*= -<span class=hljs-number >1</span><span class=hljs-literal >im</span>
   ifft!(rhok)
   real(rhok)
<span class=hljs-keyword >end</span></code></pre>
<h1 id=landau_damping ><a href="#landau_damping">Landau Damping</a></h1>
<p><a href="https://en.wikipedia.org/wiki/Landau_damping">Landau damping - Wikipedia</a></p>
<pre><code class="julia hljs"><span class=hljs-keyword >function</span> landau( ϵ, kx, meshx, meshv)
    nx = meshx.nx
    nv = meshv.nx
    x  = meshx.x
    v  = meshv.x
    f  = zeros(<span class=hljs-built_in >Complex</span>{<span class=hljs-built_in >Float64</span>},(nx,nv))
    f .= (<span class=hljs-number >1.0</span>.+ϵ*cos.(kx*x))/sqrt(<span class=hljs-number >2</span><span class=hljs-literal >π</span>) .* transpose(exp.(-<span class=hljs-number >0.5</span>*v.^<span class=hljs-number >2</span>))
    f
<span class=hljs-keyword >end</span>

<span class=hljs-keyword >function</span> advection_x!( f, p, meshx, v, dt) 
    advection!(f, p, meshx, v, dt)
<span class=hljs-keyword >end</span>

<span class=hljs-keyword >function</span> advection_v!( f, fᵗ, p, meshx, meshv, ℰ, dt)
     dx = meshx.dx
     nx = meshx.nx
     ρ  = compute_rho(meshv, f)
     e  = compute_e(meshx, ρ)
     push!(ℰ, <span class=hljs-number >0.5</span>*log(sum(e.*e)*dx))
     transpose!(fᵗ, f)
     advection!(fᵗ, p, meshv, e, dt)
     transpose!(f, fᵗ)
<span class=hljs-keyword >end</span>

<span class=hljs-keyword >function</span> landau_damping(tf::<span class=hljs-built_in >Float64</span>, nt::<span class=hljs-built_in >Int64</span>)
    
  <span class=hljs-comment ># Set grid</span>
  p = <span class=hljs-number >3</span>
  nx, nv = <span class=hljs-number >128</span>, <span class=hljs-number >256</span>
  xmin, xmax = <span class=hljs-number >0.0</span>, <span class=hljs-number >4</span><span class=hljs-literal >π</span>
  vmin, vmax = -<span class=hljs-number >6.</span>, <span class=hljs-number >6.</span>
  meshx = UniformMesh(xmin, xmax, nx)
  meshv = UniformMesh(vmin, vmax, nv)
  x, v = meshx.x, meshv.x
    
  <span class=hljs-comment ># Set distribution function for Landau damping</span>
  ϵ, kx = <span class=hljs-number >0.001</span>, <span class=hljs-number >0.5</span>
  f = landau( ϵ, kx, meshx, meshv)
  
  fᵗ = zeros(<span class=hljs-built_in >Complex</span>{<span class=hljs-built_in >Float64</span>},(nv,nx))
  
  <span class=hljs-comment ># Set time domain</span>
  dt = tf / nt
  
  <span class=hljs-comment ># Run simulation</span>
  ℰ = <span class=hljs-built_in >Float64</span>[]
  
  <span class=hljs-keyword >for</span> it <span class=hljs-keyword >in</span> <span class=hljs-number >1</span>:nt
        
     advection_x!( f, p, meshx, v, <span class=hljs-number >0.5</span>dt)
     advection_v!( f, fᵗ, p, meshx, meshv, ℰ, dt)
     advection_x!( f, p, meshx, v, <span class=hljs-number >0.5</span>dt)
        
  <span class=hljs-keyword >end</span>
                  
  ℰ

<span class=hljs-keyword >end</span></code></pre>
<h2 id=run_the_simulation ><a href="#run_the_simulation">Run the simulation</a></h2>
<pre><code class="julia hljs">nt = <span class=hljs-number >1000</span>
tf = <span class=hljs-number >100.0</span>
t  = range(<span class=hljs-number >0.0</span>, stop=tf, length=nt)
<span class=hljs-meta >@time</span> nrj = landau_damping(tf, nt);

plot( t, nrj; label = <span class=hljs-string >&quot;E&quot;</span>)
plot!(t, -<span class=hljs-number >0.1533</span>*t.-<span class=hljs-number >5.50</span>; label=<span class=hljs-string >&quot;-0.1533t.-5.5&quot;</span>)</code></pre>
<img src="/assets/sl/code_sl/output/landau1.svg" alt="">
<h1 id=callable_type ><a href="#callable_type">Callable type</a></h1>
<pre><code class="julia hljs"><span class=hljs-string >&quot;&quot;&quot;
    Advection(f, p, mesh, v, nv, dt)

Advection type

&quot;&quot;&quot;</span>
<span class=hljs-keyword >mutable struct</span> Advection
    
    p        :: <span class=hljs-built_in >Int64</span> 
    mesh     :: UniformMesh
    modes    :: <span class=hljs-built_in >Vector</span>{<span class=hljs-built_in >Float64</span>}
    eig_bspl :: <span class=hljs-built_in >Vector</span>{<span class=hljs-built_in >Float64</span>}
    eigalpha :: <span class=hljs-built_in >Vector</span>{<span class=hljs-built_in >Complex</span>{<span class=hljs-built_in >Float64</span>}}
    
    <span class=hljs-keyword >function</span> Advection( p, mesh )
        nx        = mesh.nx
        modes     = zeros(<span class=hljs-built_in >Float64</span>, nx)
        modes    .= [<span class=hljs-number >2</span><span class=hljs-literal >π</span> * i / nx <span class=hljs-keyword >for</span> i <span class=hljs-keyword >in</span> <span class=hljs-number >0</span>:nx-<span class=hljs-number >1</span>]
        eig_bspl  = zeros(<span class=hljs-built_in >Float64</span>, nx)
        eig_bspl  = zeros(<span class=hljs-built_in >Float64</span>, nx)
        eig_bspl .= bspline(p, -div(p+<span class=hljs-number >1</span>,<span class=hljs-number >2</span>), <span class=hljs-number >0.0</span>)
        <span class=hljs-keyword >for</span> i <span class=hljs-keyword >in</span> <span class=hljs-number >1</span>:div(p+<span class=hljs-number >1</span>,<span class=hljs-number >2</span>)-<span class=hljs-number >1</span>
            eig_bspl .+= bspline(p, i-(p+<span class=hljs-number >1</span>)÷<span class=hljs-number >2</span>, <span class=hljs-number >0.0</span>) * <span class=hljs-number >2</span> .* cos.(i * modes)
        <span class=hljs-keyword >end</span>
        eigalpha  = zeros(<span class=hljs-built_in >Complex</span>{<span class=hljs-built_in >Float64</span>}, nx)
        new( p, mesh, modes, eig_bspl, eigalpha )
    <span class=hljs-keyword >end</span>
    
<span class=hljs-keyword >end</span>

<span class=hljs-keyword >function</span> (adv :: Advection)(f    :: <span class=hljs-built_in >Array</span>{<span class=hljs-built_in >Complex</span>{<span class=hljs-built_in >Float64</span>},<span class=hljs-number >2</span>}, 
                            v    :: <span class=hljs-built_in >Vector</span>{<span class=hljs-built_in >Float64</span>}, 
                            dt   :: <span class=hljs-built_in >Float64</span>)
    
   nx = adv.mesh.nx
   nv = length(v)
   dx = adv.mesh.dx
    
   fft!(f,<span class=hljs-number >1</span>)
    
   <span class=hljs-keyword >for</span> j <span class=hljs-keyword >in</span> <span class=hljs-number >1</span>:nv
      <span class=hljs-meta >@inbounds</span> alpha = dt * v[j] / dx
      <span class=hljs-comment ># compute eigenvalues of cubic splines evaluated at displaced points</span>
      ishift = floor(-alpha)
      beta   = -ishift - alpha
      fill!(adv.eigalpha,<span class=hljs-number >0.0</span><span class=hljs-literal >im</span>)
      <span class=hljs-keyword >for</span> i <span class=hljs-keyword >in</span> -div(adv.p-<span class=hljs-number >1</span>,<span class=hljs-number >2</span>):div(adv.p+<span class=hljs-number >1</span>,<span class=hljs-number >2</span>)
         adv.eigalpha .+= (bspline(adv.p, i-div(adv.p+<span class=hljs-number >1</span>,<span class=hljs-number >2</span>), beta) 
                        .* exp.((ishift+i) * <span class=hljs-number >1</span><span class=hljs-literal >im</span> .* adv.modes))
      <span class=hljs-keyword >end</span>
          
      <span class=hljs-comment ># compute interpolating spline using fft and properties of circulant matrices</span>
      
      <span class=hljs-meta >@inbounds</span> f[:,j] .*= adv.eigalpha ./ adv.eig_bspl
        
   <span class=hljs-keyword >end</span>
        
   ifft!(f,<span class=hljs-number >1</span>)
    
<span class=hljs-keyword >end</span>            

<span class=hljs-keyword >function</span> landau_damping_hl(tf::<span class=hljs-built_in >Float64</span>, nt::<span class=hljs-built_in >Int64</span>)
    
  <span class=hljs-comment ># Set grid</span>
  p = <span class=hljs-number >3</span>
  nx, nv = <span class=hljs-number >128</span>, <span class=hljs-number >256</span>
  xmin, xmax = <span class=hljs-number >0.0</span>, <span class=hljs-number >4</span><span class=hljs-literal >π</span>
  vmin, vmax = -<span class=hljs-number >6.</span>, <span class=hljs-number >6.</span>
  meshx = UniformMesh(xmin, xmax, nx)
  meshv = UniformMesh(vmin, vmax, nv)
  x, v = meshx.x, meshv.x    
  dx = meshx.dx
  
  <span class=hljs-comment ># Set distribution function for Landau damping</span>
  ϵ, kx = <span class=hljs-number >0.001</span>, <span class=hljs-number >0.5</span>
  f = landau( ϵ, kx, meshx, meshv)
  fᵗ = zeros(<span class=hljs-built_in >Complex</span>{<span class=hljs-built_in >Float64</span>},(nv,nx))
    
  <span class=hljs-comment ># Instantiate advection functions</span>
  advection_x! = Advection(p, meshx)
  advection_v! = Advection(p, meshv)
  
  <span class=hljs-comment ># Set time step</span>
  dt = tf / nt
  
  <span class=hljs-comment ># Run simulation</span>
  ℰ = <span class=hljs-built_in >Float64</span>[]
  
  <span class=hljs-keyword >for</span> it <span class=hljs-keyword >in</span> <span class=hljs-number >1</span>:nt
        
       advection_x!(f, v, <span class=hljs-number >0.5</span>dt)

       ρ = compute_rho(meshv, f)
       e = compute_e(meshx, ρ)
        
       push!(ℰ, <span class=hljs-number >0.5</span>*log(sum(e.*e)*dx))
        
       transpose!(fᵗ, f)
       advection_v!(fᵗ, e, dt)
       transpose!(f, fᵗ)
    
       advection_x!(f, v, <span class=hljs-number >0.5</span>dt)
        
  <span class=hljs-keyword >end</span>
                  
  ℰ

<span class=hljs-keyword >end</span>

nt = <span class=hljs-number >1000</span>
tf = <span class=hljs-number >100.0</span>
t  = range(<span class=hljs-number >0.0</span>, stop=tf, length=nt)
<span class=hljs-meta >@time</span> nrj = landau_damping_hl(tf, nt);

plot( t, nrj; label = <span class=hljs-string >&quot;E&quot;</span>)
plot!(t, -<span class=hljs-number >0.1533</span>*t.-<span class=hljs-number >5.50</span>; label=<span class=hljs-string >&quot;-0.1533t.-5.5&quot;</span>)</code></pre>
<img src="/assets/sl/code_sl/output/landau2.svg" alt="">
<h2 id=metaprogramming ><a href="#metaprogramming">Metaprogramming</a></h2>
<pre><code class="julia hljs"><span class=hljs-string >&quot;&quot;&quot;

    @Strang( push_t, push_v )

    Apply the second order Strang splitting

    push_t and push_v are two function calls with
    `dt` as argument.

&quot;&quot;&quot;</span>
<span class=hljs-keyword >macro</span> Strang(push_t, push_v)
    <span class=hljs-keyword >return</span> esc(<span class=hljs-keyword >quote</span>
        <span class=hljs-keyword >local</span> full_dt = dt
        dt = <span class=hljs-number >0.5</span>full_dt
        $push_t
        dt = full_dt
        $push_v
        dt = <span class=hljs-number >0.5</span>full_dt
        $push_t
        dt = full_dt
    <span class=hljs-keyword >end</span>)
<span class=hljs-keyword >end</span>

<span class=hljs-keyword >function</span> landau_with_macro(tf::<span class=hljs-built_in >Float64</span>, nt::<span class=hljs-built_in >Int64</span>)
    
  <span class=hljs-comment ># Set grid</span>
  p = <span class=hljs-number >3</span>
  nx, nv = <span class=hljs-number >128</span>, <span class=hljs-number >256</span>
  xmin, xmax = <span class=hljs-number >0.0</span>, <span class=hljs-number >4</span><span class=hljs-literal >π</span>
  vmin, vmax = -<span class=hljs-number >6.</span>, <span class=hljs-number >6.</span>
  meshx = UniformMesh(xmin, xmax, nx)
  meshv = UniformMesh(vmin, vmax, nv)
  x, v = meshx.x, meshv.x    
  dx = meshx.dx
  
  <span class=hljs-comment ># Set distribution function for Landau damping</span>
  ϵ, kx = <span class=hljs-number >0.001</span>, <span class=hljs-number >0.5</span>
  f  = landau( ϵ, kx, meshx, meshv)
  fᵗ = zeros(<span class=hljs-built_in >Complex</span>{<span class=hljs-built_in >Float64</span>},(nv,nx))
    
  <span class=hljs-comment ># Instantiate distribution functions</span>
  advection_x! = Advection(p, meshx)
  advection_v! = Advection(p, meshv)
    
  push_t!( f, v, dt ) = advection_x!(f, v, dt)

  <span class=hljs-keyword >function</span> push_v!( f, fᵗ, meshx, meshv, dt, ℰ)
    
      ρ = compute_rho(meshv, f)
      e = compute_e(meshx, ρ)
     
      push!(ℰ, <span class=hljs-number >0.5</span>*log(sum(e.*e)*dx))
     
      transpose!(fᵗ, f)
      advection_v!(fᵗ, e, dt)
      transpose!(f, fᵗ)
    
  <span class=hljs-keyword >end</span>
  
  <span class=hljs-comment ># Set time step</span>
  dt = tf / nt
  
  <span class=hljs-comment ># Run simulation</span>
  ℰ = <span class=hljs-built_in >Float64</span>[]
  
  <span class=hljs-keyword >for</span> it <span class=hljs-keyword >in</span> <span class=hljs-number >1</span>:nt
        
       <span class=hljs-meta >@Strang</span>( push_t!( f, v, dt ),
                push_v!( f, fᵗ, meshx, meshv, dt, ℰ))
        
  <span class=hljs-keyword >end</span>
                  
  ℰ

<span class=hljs-keyword >end</span>

nt = <span class=hljs-number >1000</span>
tf = <span class=hljs-number >100.0</span>
t  = range(<span class=hljs-number >0.0</span>, stop=tf, length=nt)
<span class=hljs-meta >@time</span> nrj = landau_with_macro(tf, nt);
plot( t, nrj; label = <span class=hljs-string >&quot;E&quot;</span>)
plot!(t, -<span class=hljs-number >0.1533</span>*t.-<span class=hljs-number >5.50</span>; label=<span class=hljs-string >&quot;-0.1533t.-5.5&quot;</span>)</code></pre>
<img src="/assets/sl/code_sl/output/landau3.svg" alt="">
<div class=page-foot >
  <div class=copyright >
    &copy; Pierre Navaro. Last modified: December 15, 2020. Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a>.
  </div>
</div>
</div>
    </div>